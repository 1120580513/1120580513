# 操作系统

- **防止硬件被失控的应用程序滥用**
- **向而应用程序提供简单一致的机制来控制低级硬件设备**
  > 操作系统通过进程、虚拟内存、文件来实现以上基本功能

## 计算机系统的抽象

<table style="width:100%">
   <thead>
     <tr>
       <th colspan="4">虚拟机</th>
     </tr>
   </thead>
   <tbody>
     <tr>
       <td>操作系统</td>
       <td colspan="3">进程</td>
     </tr>
     <tr>
       <td></td>
       <td>指令集架构</td>
       <td colspan="2">虚拟内存</td>
     </tr>
     <tr>
       <td></td>
       <td>处理器</td>
       <td>主存</td>
       <td>文件</td>
     </tr>
     <tr>
       <td colspan="3"></td>
       <td>I/O设备</td>
     </tr>
   </tbody>
 </table>

### 进程

- `进程`：**对一个正在运行的程序的抽象**使程序看上去好像独占地使用处理器、主存、I/O 设备
- `上下文`：**操作系统保持跟踪进程运行所需的所有状态信息**这种状态就是上下文
- `并发运行`：**一个进程的指令和另一个进程的指令是交错执行的**
- `上下文切换`: **保存当前进程的上下文，恢复新进程的上下文，然后将控制权转给新进程**
- `系统内核`: **操作系统代码常驻主存部分，是系统管理全部进程所用代码和数据结构的集合**
  > 单核处理器在一个时刻只能执行一个程序，多核处理器同一时刻能执行多个程序

#### 线程

`线程`：**一个进程可以由多个线程的执行单元组成，都运行在进程的上下文中，并共享同样的代码和数据结构**

> Linux 中的进程相当于 Windows 中的线程

#### 并发和并行

- `并发`：**同时具有多个活动的系统**
- `并行`：**并发来使系统运行的更快**

##### 线程级并发

###### 多核处理器

> 多核处理器由多个 CPU 核和 L3 高速缓存组成，每个核都有自己的 L1 数据高速缓存、L1 指令高速缓存、L2 高速缓存
> 减少了在执行多个任务时模拟并发的需求、当程序以多线程方式编写时线程可以并行地高效执行

##### 指令级并行

- `指令级并行`：**处理器可以同时执行多条指令**
- `流水线`：**将一条指令所需要的活动分成不同的步骤，将 CPU 的硬件组织成一系列的阶段，每个阶段执行一个步骤，这些阶段可以并发的操作**
- `超标量`：**处理器的执行速率达到比一个周期一条指令更快**
  >

##### 单指令、多数据并行

`单指令、多数据并行(SIMD并行)`：**允许一条指令产生多个可并行执行的操作** _大多是为了提高处理影像、声音、视频数据应用的效率_

## 内存

- `虚拟内存`：**对程序存储器的抽象**
- `虚拟内存空间地址`：_进程看到的内存都是一致的，由大量准确定义的区构成，每个区都有专门的功能_
- `物理内存`：**实际上的内存**
- `物理内存空间地址`：**实际上的 RAM 内存条的空间**
- `驻留内存`：**被映射到虚拟内存空间的物理内存**
- `共享内存`：**被多个进程共享的内存**
- [存储器层次结构](/1.计算机基础/1.硬件.html#存储器层次结构)

### 虚拟内存

> 虚拟内存被组织成 N 个连续的字节大小的单元组成的数组，每字节都有唯一的虚拟地址，作为数组的索引。VM 系统将虚拟内存分割为虚拟页的大小固定的块，物理内存也被分为物理页。
> 物理页缓存在 L1、L2、L3 中，虚拟页缓存在主存中。


- `页表`：页表条目的数组用于将虚拟页映射到物理页
- `缺页`：读写取虚拟内存时，DRAM 不命中，触发缺页异常，调用内核异常处理程序，选择一个牺牲页，更新该页，重启导致缺页的命令
- **每当 CPU 产生一个虚拟地址，MMU 就必须查阅一个 PTE，以便将虚拟地址翻译为物理地址**
- `碎片`：虽然有未使用的内存，但不能满足分配请求
- `内部碎片`：已分配块大小和它们的有效载荷大小之差的和
- `外部碎片`：当空闲内存合计可满足分配请求，但没有一个内存块足够大可以处理这个请求
- `空闲链表`：大多数分配器将边界、是否已分配的信息嵌入块本身，空闲块通过头部中的大小字段隐含连接
  > **以下使用 DRAM 表示常驻内存的页表**
- `CPU访问主存`：_CPU 提供虚拟内存地址，通过地址翻译来定位 DRAM 中的列表条目，如果不命中(也叫缺页)则触发缺页异常，调用内核异常处理程序，选择一个牺牲页，更新该页并重启导致缺页的命令，命中列表条目，得到物理地址_
  > 操作系统为每个进程提供了独立的页面也就是提供了独立的虚拟地址空间
- `共享物理页面`：_被多个虚拟地址空间映射_

#### 虚拟内存地址空间(按区分配)

- **内核虚拟内存** _顶级区域,隐藏_
- **用户栈** _编译器用它来实现函数调用(每调用一个函数，栈就增长，从一个函数返回时，栈就减少)_
- **共享库** _存放像 C 标准库和数学库这样的共享库的代码和数据的区域_
- **运行时堆** _存放运行时的数据_
- **程序代码和数据** _进程开始运行时按照可执行目标文件的内容初始化_
- **0**
  > Linux 不共享内核虚拟内存

## 文件

`文件`：**对 I/O 设备的抽象**

### 网络

`网络`：**可视为一个 I/O 设备** _当系统从主存复制一串字节到网络适配器时，数据流经过网络到达另一台机器_
