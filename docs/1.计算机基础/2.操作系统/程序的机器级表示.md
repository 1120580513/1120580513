# 程序的机器级表示

- ISA Instruction Set Architecture 指令集体系结构/指令集架构
- PC 程序计数器，将要执行的下一条指令在内存中的地址

## 汇编代码(x86-64)

> 点开头的行都是指导汇编器和链接器工作的伪指令，通常可以忽略

- 指令后缀
  - b 字节
  - w 字
  - l 双字
  - q 四字
- 寄存器，以 %r 开头
  - 8   16  32   64   寄存器位数
  - %al %ax %eax %rax 返回值
  - %bl %bx %ebx %rbx 被调用者保存 
  - %cl %cx %ecx %rcx 第4个参数 
  - %dl %dx %edx %rdx 第3个参数 
  - %sil %si %esi %rsi 第2个参数 
  - %dil %di %edi %rdi 第1个参数 
  - %bpl %bp %ebp %rbp 被调用者保存
  - %spl %sp %esp %rsp 栈指针 
  - %r8b %r8w %r8d %r8 第5个参数 
  - %r9b %r9w %r9d %r9 第6个参数 
  - %r10b %r10w %r10d %r10 调用者保存
  - %r11b %r11w %r11d %r11 调用者保存
  - %r12b %r12w %r12d %r12 被调用者保存
  - %r13b %r13w %r13d %r13 被调用者保存
  - %r14b %r14w %r14d %r14 被调用者保存
  - %r15b %r15w %r15d %r15 被调用者保存
- 操作数指示符
  - 操作数值
    - Imm 立即数
    - ra【a是右下的角标】 表示寄存器a
    - R\[ra] 寄存器a的值，将所有寄存器集合看成数组R
    - M\[Addr] 对存储在内存中从 Addr 开始的 b 个字节的引用，b是M的下标，一般省略
  - 格式: 操作数值    
    - $Imm: Imm 
    - ra: R\[ra]   
    - Imm: M\[Imm]
    - (ra): M\[R\[ra]]
    - Imm(ra): M\[Imm+R\[ra]]
    - (rb,ri): M\[R\[rb]+R\[ri]]
    - Imm(rb,ri): M\[Imm+R\[rb]+R\[ri]]
    - (,ri,s): M\[R\[ri]*s]
    - Imm(,ri,s): M\[Imm+R\[ri]*s]
    - (rb,ri,s): M\[R\[rb]+R\[ri]*s]
    - Imm(rb,ri,s): M\[Imm+R\[rb]+R\[ri]*s]
- 指令
  - MOV S,D 传送
    - movb/movw/movl/movq
    - movabsq 传送绝对的四字
  - MOVZ S,R 对零扩展进行传送
    - 两个大小指示符，第一个指定源的大小，第二个指明目的大小
    - movzbw/movzbl/movzwl/movzbq/movzwq
  - MOVS S,R 传送符号扩展字节，把源的最高位扩展
    - movsbw/movsbl/movsws/movsbq/movswq/movslq
    - cltq 把%eax符号扩展到%rax
  - pushq S 将四字压入栈 
  - popq D 将四字弹出栈
  - leaq S,D 将 S 的地址传送给 D
    - D 为寄存器时，表示计算S并赋值给D
  - INC D 加1
  - DEC D 减1
  - NEG D 取负
  - NOT D 取补
  - ADD S,D 加 S
  - SUB S,D 减 S
  - IMUL S,D 乘 S
  - XOR S,D 异或 S
  - OR S,D 或 S
  - AND S,D 与 S
  - SAL k,D 左移 k
  - SHL k,D 同 SAL
  - SAR k,D 算术右移
  - SHR k,D 逻辑右移